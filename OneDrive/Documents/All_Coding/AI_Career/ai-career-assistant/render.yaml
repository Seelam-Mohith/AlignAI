services:
  # Frontend - React App
  - type: web
    name: alignai-frontend
    runtime: node
    plan: free
    buildCommand: npm install --prefix client && npm run build --prefix client
    startCommand: npm start --prefix client
    envVars:
      - key: REACT_APP_API_URL
        value: https://alignai-backend.onrender.com/api
      - key: REACT_APP_ML_SERVICE_URL
        value: https://alignai-ml-service.onrender.com
      - key: NODE_ENV
        value: production

  # Backend - Express Server
  - type: web
    name: alignai-backend
    runtime: node
    plan: free
    buildCommand: npm install --prefix server
    startCommand: npm start --prefix server
    envVars:
      - key: PORT
        value: 5000
      - key: ML_SERVICE_URL
        value: https://alignai-ml-service.onrender.com
      - key: NODE_ENV
        value: production
      - key: CORS_ORIGIN
        value: https://alignai-frontend.onrender.com

  # ML Service - Python/FastAPI
  - type: web
    name: alignai-ml-service
    runtime: python
    plan: free
    buildCommand: pip install -r ml-service/requirements.txt
    startCommand: "cd ml-service && gunicorn -w 1 -b 0.0.0.0:8000 main:app"
    envVars:
      - key: PYTHON_VERSION
        value: 3.9

